<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>DbAdapter</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_DbAdapter.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption empty">&nbsp;</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">DbAdapter</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types queryable in the db
</a></li><li><a href="#g:2">Db updates
</a></li><li><a href="#g:3">Db retrieval
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implementation of persistent db storage for user defined portfolio information
and quote information retrieved from yahoo
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:dbFile">dbFile</a> :: IO FilePath</li><li class="src short"><a href="#v:connect">connect</a> :: FilePath -&gt; IO Connection</li><li class="src short"><a href="#v:stringify">stringify</a> :: Converters a =&gt; ([String] -&gt; String) -&gt; [a] -&gt; [String]</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Portfolio">Portfolio</a>  = <a href="#v:Portfolio">Portfolio</a> {<ul class="subs"><li><a href="#v:prtfsymbol">prtfsymbol</a> :: String</li><li><a href="#v:prtfcurrency">prtfcurrency</a> :: String</li><li><a href="#v:prtfposition">prtfposition</a> :: Double</li><li><a href="#v:prtfstrike">prtfstrike</a> :: Double</li><li><a href="#v:prtfprice">prtfprice</a> :: Double</li><li><a href="#v:prtfchange">prtfchange</a> :: Double</li><li><a href="#v:prtfpctchange">prtfpctchange</a> :: Double</li><li><a href="#v:prtfvolume">prtfvolume</a> :: Double</li><li><a href="#v:prtffxp">prtffxp</a> :: Double</li></ul>}</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Position">Position</a>  = <a href="#v:Position">Position</a> {<ul class="subs"><li><a href="#v:symbol">symbol</a> :: String</li><li><a href="#v:currency">currency</a> :: String</li><li><a href="#v:position">position</a> :: Double</li><li><a href="#v:strike">strike</a> :: Double</li></ul>}</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Fx">Fx</a>  = <a href="#v:Fx">Fx</a> {<ul class="subs"><li><a href="#v:fxToCcy">fxToCcy</a> :: String</li><li><a href="#v:fxFromCcy">fxFromCcy</a> :: String</li><li><a href="#v:fx">fx</a> :: Double</li></ul>}</li><li class="src short"><a href="#v:insertPosition">insertPosition</a> :: IConnection conn =&gt; conn -&gt; <a href="DbAdapter.html#t:Position">Position</a> -&gt; IO Integer</li><li class="src short"><a href="#v:insertFx">insertFx</a> :: IConnection conn =&gt; conn -&gt; [<a href="DbAdapter.html#t:Fx">Fx</a>] -&gt; IO ()</li><li class="src short"><a href="#v:populateQuotesTable">populateQuotesTable</a> :: IConnection conn =&gt; conn -&gt; [<a href="Yahoo.html#t:Symbol">Symbol</a>] -&gt; IO ()</li><li class="src short"><a href="#v:fetchSymbols">fetchSymbols</a> :: IConnection conn =&gt; conn -&gt; IO [String]</li><li class="src short"><a href="#v:fetchPositions">fetchPositions</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Position">Position</a>]</li><li class="src short"><a href="#v:fetchFx">fetchFx</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Fx">Fx</a>]</li><li class="src short"><a href="#v:fetchPortfolio">fetchPortfolio</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Portfolio">Portfolio</a>]</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:dbFile" class="def">dbFile</a> :: IO FilePath</p><div class="doc"><p>The location of the db on disk
</p></div></div><div class="top"><p class="src"><a name="v:connect" class="def">connect</a> :: FilePath -&gt; IO Connection</p><div class="doc"><p>Initialise the db with a minimal schema and return a db connection.
 The db will be created if it doesn't already exist.
</p></div></div><div class="top"><p class="src"><a name="v:stringify" class="def">stringify</a> :: Converters a =&gt; ([String] -&gt; String) -&gt; [a] -&gt; [String]</p><div class="doc"><p>Convert a list of Converters instances into a list of strings.
Each converter object has its fields converted to string representations.
The list of fields is further converted into a single string using the supplied
([String] -&gt; String) function
</p></div></div><h2 id="g:1">Types queryable in the db
</h2><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Portfolio" class="def">Portfolio</a>  </p><div class="doc"><p>Haskell structure that represents the command line output table
  including yahoo quotes and portfolio position info
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Portfolio" class="def">Portfolio</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:prtfsymbol" class="def">prtfsymbol</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfcurrency" class="def">prtfcurrency</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfposition" class="def">prtfposition</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfstrike" class="def">prtfstrike</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfprice" class="def">prtfprice</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfchange" class="def">prtfchange</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfpctchange" class="def">prtfpctchange</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtfvolume" class="def">prtfvolume</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:prtffxp" class="def">prtffxp</a> :: Double</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Portfolio" class="caption collapser" onclick="toggleSection('i:Portfolio')">Instances</p><div id="section.i:Portfolio" class="show"><table><tr><td class="src">Eq <a href="DbAdapter.html#t:Portfolio">Portfolio</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="DbAdapter.html#t:Portfolio">Portfolio</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="DbAdapter.html#t:Portfolio">Portfolio</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Position" class="def">Position</a>  </p><div class="doc"><p>Haskell structure that contains the portfolio position information
  entered by the user
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Position" class="def">Position</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:symbol" class="def">symbol</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:currency" class="def">currency</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:position" class="def">position</a> :: Double</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:strike" class="def">strike</a> :: Double</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Position" class="caption collapser" onclick="toggleSection('i:Position')">Instances</p><div id="section.i:Position" class="show"><table><tr><td class="src">Eq <a href="DbAdapter.html#t:Position">Position</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="DbAdapter.html#t:Position">Position</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="DbAdapter.html#t:Position">Position</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Fx" class="def">Fx</a>  </p><div class="doc"><p>Haskell structure that contains the fx to convert yahoo quotes into
 the symbol currency entered by the user
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Fx" class="def">Fx</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fxToCcy" class="def">fxToCcy</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:fxFromCcy" class="def">fxFromCcy</a> :: String</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:fx" class="def">fx</a> :: Double</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Fx" class="caption collapser" onclick="toggleSection('i:Fx')">Instances</p><div id="section.i:Fx" class="show"><table><tr><td class="src">Eq <a href="DbAdapter.html#t:Fx">Fx</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Ord <a href="DbAdapter.html#t:Fx">Fx</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Show <a href="DbAdapter.html#t:Fx">Fx</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h2 id="g:2">Db updates
</h2><div class="top"><p class="src"><a name="v:insertPosition" class="def">insertPosition</a> :: IConnection conn =&gt; conn -&gt; <a href="DbAdapter.html#t:Position">Position</a> -&gt; IO Integer</p><div class="doc"><p>Add a new position to the db
</p><p>The user specifies all the fields to be inserted in the db.
</p></div></div><div class="top"><p class="src"><a name="v:insertFx" class="def">insertFx</a> :: IConnection conn =&gt; conn -&gt; [<a href="DbAdapter.html#t:Fx">Fx</a>] -&gt; IO ()</p><div class="doc"><p>Add the current fx to the db
</p><p>The required fxs are inferred from the currencies the user has specified
of the price they entered a position in, and the currency yahoo claims it
returns quotes in.
There are known issues with the yahoo currency so the retrieval of the
appropriate fx values from yahoo is not implemented yet
</p></div></div><div class="top"><p class="src"><a name="v:populateQuotesTable" class="def">populateQuotesTable</a> :: IConnection conn =&gt; conn -&gt; [<a href="Yahoo.html#t:Symbol">Symbol</a>] -&gt; IO ()</p><div class="doc"><p>Add yahoo quotes to the db
</p><p>The set of symbols to retrieve is inferred from the symbols the user
has entered in their portfolio.
</p></div></div><h2 id="g:3">Db retrieval
</h2><div class="top"><p class="src"><a name="v:fetchSymbols" class="def">fetchSymbols</a> :: IConnection conn =&gt; conn -&gt; IO [String]</p><div class="doc"><p>Retrieve symbols from the db
</p><p>This is the set of unique symbols specified by the user as part of their
portfolio
</p></div></div><div class="top"><p class="src"><a name="v:fetchPositions" class="def">fetchPositions</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Position">Position</a>]</p><div class="doc"><p>Fetch the user defined positions from the db 
</p></div></div><div class="top"><p class="src"><a name="v:fetchFx" class="def">fetchFx</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Fx">Fx</a>]</p><div class="doc"><p>Fetch fx from the db
</p><p>This is the set of fxs we require based on the user defined and yahoo 
currencies in the portfolio. 
</p></div></div><div class="top"><p class="src"><a name="v:fetchPortfolio" class="def">fetchPortfolio</a> :: IConnection conn =&gt; conn -&gt; IO [<a href="DbAdapter.html#t:Portfolio">Portfolio</a>]</p><div class="doc"><p>Fetch the portfolio from the db
</p><p>This is the set of positions defined by the user, supplemented with 
the latest quote data from yahoo
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>